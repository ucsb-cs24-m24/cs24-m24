var cal_dates = [ {"label":"First day of classes", "date":"2024-01-08" }, {"label":"Drop deadline (no W grade)","date":"2023-10-25" }, {"label":"Thanksgiving - No lecture", "date":"2023-11-22" }, {"label":"F23 Instruction Ends", "date":"2023-12-08" },   {"label":"F23 Quarter Ends", "date":"2023-12-15" }           ]
;

var dates = [{
    "type" : "lab",
    "url" :  "/w24/lab/lab00/",	   
    "num" : "lab00",
    "assigned" : "2024-01-10 09:00:00 -0800",
    "due" : "2024-01-17 23:59:00 -0800",    
    "ready" : "true",
    "desc" : "Getting started",
    
}
,{
    "type" : "lab",
    "url" :  "/w24/lab/lab01/",	   
    "num" : "lab01",
    "assigned" : "2024-01-17 09:00:00 -0800",
    "due" : "2024-01-24 23:59:00 -0800",    
    "ready" : "true",
    "desc" : "Objective Cars",
    
}
,{
    "type" : "lab",
    "url" :  "/w24/lab/lab02/",	   
    "num" : "lab02",
    "assigned" : "2024-01-24 09:00:00 -0800",
    "due" : "2024-01-31 23:59:00 -0800",    
    "ready" : "true",
    "desc" : "Binary Search Tree",
    
}
,{
    "type" : "lab",
    "url" :  "/w24/lab/lab03/",	   
    "num" : "lab03",
    "assigned" : "2024-01-24 09:00:00 -0800",
    "due" : "2024-02-07 23:59:00 -0800",    
    "ready" : "true",
    "desc" : "Implementing a linked list- OOP style",
    
}
,{
    "type" : "lab",
    "url" :  "/w24/lab/lab04/",	   
    "num" : "lab04",
    "assigned" : "2024-01-31 09:00:00 -0800",
    "due" : "2024-02-07 23:59:00 -0800",    
    "ready" : "true",
    "desc" : "Complexity Analysis - Part 1 (midterm practice)",
    
}
,{
    "type" : "lab",
    "url" :  "/w24/lab/lab05/",	   
    "num" : "lab05",
    "assigned" : "2024-02-14 09:00:00 -0800",
    "due" : "2024-02-23 23:59:00 -0800",    
    "ready" : "true",
    "desc" : "Card game using Binary Search Trees",
    
}
,{
    "type" : "lab",
    "url" :  "/w24/lab/lab06/",	   
    "num" : "lab06",
    "assigned" : "2024-02-21 09:00:00 -0800",
    "due" : "2024-03-01 23:59:59 -0800",    
    "ready" : "true",
    "desc" : "Application of data structures to a movie dataset",
    
}
,{
    "type" : "lab",
    "url" :  "/w24/lab/lab07/",	   
    "num" : "lab07",
    "assigned" : "2024-02-28 09:00:00 -0800",
    "due" : "2024-03-12 23:59:59 -0800",    
    "ready" : "true",
    "desc" : "Application of graphs to machine learning",
    
}
,{
    "type" : "lab",
    "url" :  "/w24/lab/lab08/",	   
    "num" : "lab08",
    "assigned" : "2024-03-07 09:00:00 -0800",
    "due" : "2024-03-12 23:59:00 -0800",    
    "ready" : "true",
    "desc" : "Complexity Analysis - Part 2",
    
}
,{
    "type" : "lectures",
    "url" :  "/w24/lectures/lect01/",	   
    "num" : "lect01",
    
        
    "ready" : "true",
    "desc" : "Week 1: Course introduction, review of C16 concepts",
    
      "date" : "2024-01-08",
    
}
,{
    "type" : "lectures",
    "url" :  "/w24/lectures/lect02/",	   
    "num" : "lect02",
    
        
    "ready" : "true",
    "desc" : "Week 1: Abstract Data Types and operator overloading",
    
      "date" : "2024-01-09",
    
}
,{
    "type" : "lectures",
    "url" :  "/w24/lectures/lect02b/",	   
    "num" : "",
    
        
    
    "desc" : "No lecture - MLK Holiday",
    
      "date" : "2024-01-15",
    
}
,{
    "type" : "lectures",
    "url" :  "/w24/lectures/lect03/",	   
    "num" : "lect03",
    
        
    "ready" : "true",
    "desc" : "Week 2: Dynamic resource allocation and rule of three",
    
      "date" : "2024-01-17",
    
}
,{
    "type" : "lectures",
    "url" :  "/w24/lectures/lect04/",	   
    "num" : "lect04",
    
        
    "ready" : "true",
    "desc" : "Week 3: Efficient search with Binary Search Trees",
    
      "date" : "2024-01-22",
    
}
,{
    "type" : "lectures",
    "url" :  "/w24/lectures/lect05/",	   
    "num" : "lect05",
    
        
    "ready" : "true",
    "desc" : "Week 3: Tree traversals and BST operations(contd.)",
    
      "date" : "2024-10-24",
    
}
,{
    "type" : "lectures",
    "url" :  "/w24/lectures/lect06/",	   
    "num" : "lect06",
    
        
    "ready" : "true",
    "desc" : "Week 4: Running time analysis",
    
      "date" : "2024-01-29",
    
}
,{
    "type" : "lectures",
    "url" :  "/w24/lectures/lect07/",	   
    "num" : "lect07",
    
        
    "ready" : "true",
    "desc" : "Week 4: Space complexity, best/worst case analysis",
    
      "date" : "2024-01-31",
    
}
,{
    "type" : "lectures",
    "url" :  "/w24/lectures/lect08/",	   
    "num" : "lect08",
    
        
    "ready" : "true",
    "desc" : "Week 5: Stacks",
    
      "date" : "2024-02-05",
    
}
,{
    "type" : "lectures",
    "url" :  "/w24/lectures/lect09/",	   
    "num" : "lect09",
    
        
    "ready" : "true",
    "desc" : "Week 5: Queues",
    
      "date" : "2024-02-07",
    
}
,{
    "type" : "lectures",
    "url" :  "/w24/lectures/lect10/",	   
    "num" : "lect10",
    
        
    "ready" : "true",
    "desc" : "Week 6: C++ set and map ADT (balanced BST), Iterators",
    
      "date" : "2024-02-12",
    
}
,{
    "type" : "lectures",
    "url" :  "/w24/lectures/lect10a/",	   
    "num" : "e01",
    
        
    
    "desc" : "Midterm Exam: 11a - 12:15p",
    
      "date" : "2024-02-14",
    
}
,{
    "type" : "lectures",
    "url" :  "/w24/lectures/lect10b/",	   
    "num" : "",
    
        
    
    "desc" : "No lecture - President's Day Holiday",
    
      "date" : "2024-02-19",
    
}
,{
    "type" : "lectures",
    "url" :  "/w24/lectures/lect11/",	   
    "num" : "lect11",
    
        
    "ready" : "true",
    "desc" : "Week 7: Hashtables, C++ unordered_set and unordered_map ADT",
    
      "date" : "2024-02-21",
    
}
,{
    "type" : "lectures",
    "url" :  "/w24/lectures/lect12/",	   
    "num" : "lect12",
    
        
    "ready" : "true",
    "desc" : "Week 8: Graph representation with applications to Neural Networks",
    
      "date" : "2024-02-26",
    
}
,{
    "type" : "lectures",
    "url" :  "/w24/lectures/lect13/",	   
    "num" : "lect13",
    
        
    "ready" : "true",
    "desc" : "Week 8: Graph search and Breadth First Traversal",
    
      "date" : "2024-02-28",
    
}
,{
    "type" : "lectures",
    "url" :  "/w24/lectures/lect14/",	   
    "num" : "lect14",
    
        
    "ready" : "true",
    "desc" : "Week 9: Graph search and Depth First Traversal",
    
      "date" : "2024-03-04",
    
}
,{
    "type" : "lectures",
    "url" :  "/w24/lectures/lect15/",	   
    "num" : "lect15",
    
        
    "ready" : "true",
    "desc" : "Week 9: Running time analysis of BFS and DFS",
    
      "date" : "2024-03-06",
    
}
,{
    "type" : "lectures",
    "url" :  "/w24/lectures/lect16/",	   
    "num" : "lect16",
    
        
    "ready" : "true",
    "desc" : "Week 10: Merge Sort",
    
      "date" : "2024-03-11",
    
}
,{
    "type" : "lectures",
    "url" :  "/w24/lectures/no-lecture04/",	   
    "num" : "e02",
    
        
    
    "desc" : "Final Exam: noon - 3p",
    
      "date" : "2024-03-21",
    
}
,{
    "type" : "pa",
    "url" :  "/w24/pa/pa01/",	   
    "num" : "pa01",
    "assigned" : "2024-01-10 09:00:00 -0800",
        
    "ready" : "true",
    "desc" : "Leetcode practice with linked lists",
    
}
,{
    "type" : "pa",
    "url" :  "/w24/pa/pa02/",	   
    "num" : "pa02",
    "assigned" : "2024-01-24 09:00:00 -0800",
        
    "ready" : "true",
    "desc" : "Leetcode practice with binary search trees",
    
}
,{
    "type" : "pa",
    "url" :  "/w24/pa/pa03/",	   
    "num" : "pa03",
    "assigned" : "2024-02-21 09:00:00 -0800",
        
    "ready" : "true",
    "desc" : "Leetcode practice with stacks and queues",
    
}
,{
    "type" : "pa",
    "url" :  "/w24/pa/pa04/",	   
    "num" : "pa04",
    "assigned" : "2024-03-02 09:00:00 -0800",
        
    "ready" : "true",
    "desc" : "Leetcode practice with hashtables and hashmaps",
    
}
,{
    "type" : "pa",
    "url" :  "/w24/pa/pa05/",	   
    "num" : "pa05",
    "assigned" : "2024-03-02 09:00:00 -0800",
        
    "ready" : "true",
    "desc" : "Leetcode practice with graph search - bfs and ddfs",
    
}
,];

for (var i=0; i<cal_dates.length; i++) {
    cal_dates[i].type = "cal_date";
}
dates = dates.concat(cal_dates);

var cal = {
    numWeeks : 10,
    extraExamWeek : true,
    startDate : moment("2024-01-07"),
    startWeek : 1,
    days : {},
    days_outside_calendar : []
};


function thisDayPlusOne(thisDay) {
    return thisDay.add(1,"days");
}

function traverseDates(dates) {
    var thisDay = moment(cal.startDate);
    var mmdd = thisDay.format("MM/DD");
    for(var i=cal.startWeek; i<(cal.startWeek + cal.numWeeks); i++){
	for (var j=1; j<=7; j++) {
	    console.log("Setting up cal.days[" + mmdd + "]");
	    cal.days[mmdd] = [];
	    thisDay = thisDayPlusOne(thisDay);
	    mmdd = thisDay.format("MM/DD");	    
	}
    }
    if (cal.extraExamWeek) {
	for (var j=1; j<=7; j++) {
	    console.log("Setting up cal.days[" + mmdd + "]");
	    cal.days[mmdd] = [];
	    thisDay = thisDayPlusOne(thisDay);
	    mmdd = thisDay.format("MM/DD");	    
	}
	
    }
    for (var i = 0, len = dates.length; i < len; i++) {
	processItem(dates[i]);
    }
}

function processItem(item) {

    if (item.assigned) {
	mmdd_assigned = moment(item.assigned).format("MM/DD");
	var assigned = {"asn_type" : item.type,
			"date_type" : "assigned",
			"value": JSON.stringify(item) };
	pushToDaysOrErrors(assigned,mmdd_assigned,cal.days,cal.days_outside_calendar);
    }
    
    if (item.due) {
	var due = {"asn_type" : item.type,
		   "date_type" : "due",
		   "value": JSON.stringify(item)};
	mmdd_due = moment(item.due).format("MM/DD");
	pushToDaysOrErrors(due,mmdd_due,cal.days,cal.days_outside_calendar);
    }
    
    if (item.date) {
	mmdd_date = moment(item.date).format("MM/DD");
	var assigned = {"asn_type" : item.type,
			"date_type" : "date",
			"value": JSON.stringify(item) };
	pushToDaysOrErrors(assigned,
			   mmdd_date,
			   cal.days,
			   cal.days_outside_calendar);	
    }
}

// Used to cal.days[date], but fail over to
//  the cal.days_outside_calendar as a backup

function pushToDaysOrErrors(obj, mmdd, days, errors) {
    var daysElem = days[mmdd];
    if ( daysElem instanceof Array) {
	daysElem.push(obj);
    } else {
	var errorObject = Object();
	errorObject.mmdd = mmdd;
	errorObject.obj = obj;
	errors.push(errorObject);
    }
}

function reportError(error_message) {
    console.log(error_message);
    $('#calendar').append('<p>' + error_message + '</p>');

}


function setUpCalendar() {

    // page is now ready, initialize the calendar...
    var startDate = cal.startDate;
    var startDayOfWeek = startDate.format("ddd");

    
    if (startDayOfWeek != "Sun") {
	reportError("Error: site.start_date is not a Sunday.  Instead, it is: " + startDayOfWeek);
	return;
    }


    traverseDates(dates);
    addCalendarTable(cal);
    reportDaysOutsideCalendar(cal);

}

function addCalendarTable(cal) {
    
    $('#calendar').append(  '<table >' );
    $('#calendar table').append( '<tr><th>Week</th><th>S</th><th>M</th><th>T</th><th>W</th><th>R</th><th>F</th><th>S</th></tr>');
    var thisDay = new moment(cal.startDate);
    for(var i=cal.startWeek; i<(cal.startWeek + cal.numWeeks); i++){
	$('#calendar table').append( '<tr data-week-num="' + i +'" />')
	var thisWeeksTrSelector = '#calendar table tr[data-week-num="' + i + '"]';
	$(thisWeeksTrSelector).append('<td>' + i + '</td>');
	for (var day=1; day<=7; day++) {
	    var thisDateFormatted = thisDay.format("MM/DD");
	    var cal_mmdd = $('<div class="cal_mmdd">'+ thisDateFormatted + '</div>');
	    var assignments = getAssignments(cal,thisDateFormatted);
	    $('<td/>')
		.append(cal_mmdd)
		.append(assignments)
		.attr('data-mmdd',thisDateFormatted)
		.appendTo(thisWeeksTrSelector)
	    
	    thisDay = thisDay.add(1,'days');
	}
    }
    // TODO: Factor out duplicate code from loop above and if below
    if (cal.extraExamWeek) {
	var selector = "exam-week";
	var label = "Final<br>Exam<br>Week";
	
	$('#calendar table').append( '<tr data-week-num="' + selector +'" />')
	var thisWeeksTrSelector = '#calendar table tr[data-week-num="' + selector + '"]';
	$(thisWeeksTrSelector).append('<td class="exam-week-label">' + label + '</td>');
	for (var day=1; day<=7; day++) {
	    var thisDateFormatted = thisDay.format("MM/DD");
	    var cal_mmdd = $('<div class="cal_mmdd">'+ thisDateFormatted + '</div>');
	    var assignments = getAssignments(cal,thisDateFormatted);
	    $('<td/>')
		.append(cal_mmdd)
		.append(assignments)
		.attr('data-mmdd',thisDateFormatted)
		.appendTo(thisWeeksTrSelector)
	    
	    thisDay = thisDay.add(1,'days');
	}
    }
    
    $('.cal-assignments div[data-asn-type="hwk"]').each(function() {
	var hwk = ($(this).data("date-value"));
    if (hwk.ready && hwk.ready=="true") {
		$(this).addClass("ready");
	} else {
		$(this).addClass("not-ready");
	}
	var link = $('<a />')
	    .attr('href',hwk.url)
	    .text(hwk.num)
	    .appendTo($(this));
	$(this).addClass("hwk");
    });

    $('.cal-assignments div[data-asn-type="pa"]').each(function() {
	var asn = $(this).data("date-value");
	if (asn.ready && asn.ready=="true") {
	    $(this).addClass("ready");
	} else {
	    $(this).addClass("not-ready");
	}
	var link = $('<a />')
	    .attr('href',asn.url)
	    .text(asn.num)
	    .appendTo($(this));
	$(this).addClass("pa");
    });

    
    
    $('.cal-assignments div[data-asn-type="lab"]').each(function() {
	var asn = $(this).data("date-value");
	if (asn.ready && asn.ready=="true") {
		$(this).addClass("ready");
	} else {
		$(this).addClass("not-ready");
	}
	var link = $('<a />')
	    .attr('href',asn.url)
	    .text(asn.num)
	    .appendTo($(this));
	$(this).addClass("lab");
    });


    $('.cal-assignments div[data-asn-type="exam"]').each(function() {
	var exam = ($(this).data("date-value"));
    if (exam.ready && exam.ready=="true") {
		$(this).addClass("ready");
	} else {
		$(this).addClass("not-ready");
	}
	var label = $('<span />')
	    .text(exam.desc + ": ")
	    .appendTo($(this));
	var link = $('<a />')
	    .attr('href',exam.url)
	    .text(exam.num)
	    .appendTo($(this));
	$(this).addClass("exam")
;
    });


    $('.cal-assignments div[data-asn-type="lectures"]').each(function() {
	var asn = $(this).data("date-value");
	if (asn.ready && asn.ready=="true") {
	    $(this).addClass("ready");
	} else {
	    $(this).addClass("not-ready");
	}
	var link = $('<a />')
	    .attr('href',asn.url)
	    .text(asn.num)
	    .prependTo($(this));
	$(this).addClass("lecture");
    });

    
    $('.cal-assignments div[data-asn-type="cal_date"]').each(function() {
	var cal_date = ($(this).data("date-value"));
	$(this).addClass("ready");

	var label = $('<span />')
	    .text(cal_date.label)
	    .appendTo($(this));
	$(this).addClass("cal_date")
;
    });

    
    $('.cal-assignments div[data-date-type="due"]').each(function() {
	var asn = ($(this).data("date-value"));
	var asnType =  ($(this).data("asn-type"));
	console.log("asnType="+asnType);
	if (asnType.endsWith("WIP"))
	    return;	
	$(this).append(" due " + moment(asn.due).format("hh:mma") );
    });

    $('.cal-assignments div[data-date-type="assigned"]').each(function() {
	var asnType =  ($(this).data("asn-type"));
	console.log("asnType="+asnType);
	if (asnType.endsWith("WIP"))
	    return;
	$(this).append(" assigned");
    });

}

function getAssignments(cal,mmdd) {

    var div = $("<div />")
	.addClass("cal-assignments")
	.attr("data-mmdd",mmdd);
    if ( (typeof(cal.days[mmdd]) === undefined)
	 || (! cal.days[mmdd] instanceof Array )
	 || ( typeof(cal.days[mmdd].length) === undefined ) ) {
	div.text("error: " + mmdd);
    } else if (cal.days[mmdd].length != 0) {
	// There are some assignments
	for (var i=0,len=cal.days[mmdd].length; i<len; i++) {
	    var item=cal.days[mmdd][i];
	    $("<div />")
		.attr("data-asn-type",item.asn_type)
		.attr("data-date-type",item.date_type)
	    	.attr("data-date-value",item.value)
		.appendTo(div);
	}
    }
    
    return div;
}

function reportDaysOutsideCalendar(cal) {
    if (cal.days_outside_calendar.length > 0) {
	$('#calendar').append(  '<div class="calendar-errors" />' );
	$('#calendar div.calendar-errors').append("<h2>Errors:</h2>");
	$('#calendar div.calendar-errors').append("<p>These events were found that lie outside the range of the calendar for this term:</p>");
	for (var i=0, len=cal.days_outside_calendar.length; i<len; i++) {
	    $('#calendar div.calendar-errors').append("<p><code>" +
						      JSON.stringify(cal.days_outside_calendar[i]) +
						      "</p>");
	}
    }
}

$(document).ready(function() {
    setUpCalendar();
});

// Next, we include calendar_custom.js
// to allow customization of the calendar

/* empty file for users to override */


